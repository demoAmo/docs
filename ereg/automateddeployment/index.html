


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Technical documentation for Lesotho's Health Systems">
      
      
        <link rel="canonical" href="https://github.com/eRegister/ereg/automateddeployment/">
      
      
        <meta name="author" content="Ministry of Health">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.3.2">
    
    
      
        <title>Automated Deployment - Lesotho Health SI Systems Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fe0cca5b.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a46bcfb3.min.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="#2d3479" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#automated-deployment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://github.com/eRegister" title="Lesotho Health SI Systems Documentation" class="md-header-nav__button md-logo" aria-label="Lesotho Health SI Systems Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Lesotho Health SI Systems Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Automated Deployment
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." class="md-tabs__link">
          Overview
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../dhis2/usermanual/" class="md-tabs__link">
          DHIS2
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../informedpush/informedpush/" class="md-tabs__link">
          Informed Push
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../u-intro/" class="md-tabs__link">
          eRegister
        </a>
      
    </li>
  

  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://github.com/eRegister" title="Lesotho Health SI Systems Documentation" class="md-nav__button md-logo" aria-label="Lesotho Health SI Systems Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Lesotho Health SI Systems Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Overview
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Overview" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Welcome to SI Project Docs" class="md-nav__link">
      Welcome to SI Project Docs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../contacts/" title="Contact Information" class="md-nav__link">
      Contact Information
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      DHIS2
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="DHIS2" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        DHIS2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      User Manual
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="User Manual" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        User Manual
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dhis2/usermanual/" title="User Manual" class="md-nav__link">
      User Manual
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      DataSets
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="DataSets" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        DataSets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dhis2/intro/" title="Intro" class="md-nav__link">
      Intro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dhis2/hts/" title="HTS" class="md-nav__link">
      HTS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dhis2/tb/" title="TB" class="md-nav__link">
      TB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dhis2/tb-indicators/" title="Tb indicators" class="md-nav__link">
      Tb indicators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dhis2/tb-validation-rules/" title="Tb validation rules" class="md-nav__link">
      Tb validation rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dhis2/hiv-care-n-tx/" title="HIV Care and Treatment" class="md-nav__link">
      HIV Care and Treatment
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Technical Manual
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Technical Manual" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Technical Manual
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dhis2/installation/" title="DHIS2 Installation" class="md-nav__link">
      DHIS2 Installation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Informed Push
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Informed Push" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Informed Push
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../informedpush/informedpush/" title="Informed Push" class="md-nav__link">
      Informed Push
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../informedpush/informedpusharv/" title="Informed Push ARV" class="md-nav__link">
      Informed Push ARV
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      eRegister
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="eRegister" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        eRegister
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      User Manual
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="User Manual" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        User Manual
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../u-intro/" title="U intro" class="md-nav__link">
      U intro
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2" checked>
    
    <label class="md-nav__link" for="nav-4-2">
      Technical Manual
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Technical Manual" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Technical Manual
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../intro/" title="eRegister Installation Manual" class="md-nav__link">
      eRegister Installation Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../workingwithdockerlocally/" title="Working with Docker Images Locally" class="md-nav__link">
      Working with Docker Images Locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../FAQs/" title="FAQ's" class="md-nav__link">
      FAQ's
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../clientregistry/" title="Client Register" class="md-nav__link">
      Client Register
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../facilityimplementationchecklist/" title="Facility Implementation Checklist" class="md-nav__link">
      Facility Implementation Checklist
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Automated Deployment
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Automated Deployment" class="md-nav__link md-nav__link--active">
      Automated Deployment
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#our-automated-deployment-comprises-5-steps" class="md-nav__link">
    Our automated deployment comprises 5 steps:
  </a>
  
    <nav class="md-nav" aria-label="Our automated deployment comprises 5 steps:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0-preparatory-steps" class="md-nav__link">
    0. Preparatory Steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-removing-current-container" class="md-nav__link">
    1. Removing Current Container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-creating-a-volume" class="md-nav__link">
    2. Creating a Volume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-configuring-cronjob-restoring-database" class="md-nav__link">
    3. Configuring cronjob &amp; Restoring database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-video-below-is-an-attempt-to-demonstrate-the-steps-above" class="md-nav__link">
    The video below is an attempt to demonstrate the steps above:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#our-automated-deployment-comprises-5-steps" class="md-nav__link">
    Our automated deployment comprises 5 steps:
  </a>
  
    <nav class="md-nav" aria-label="Our automated deployment comprises 5 steps:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#0-preparatory-steps" class="md-nav__link">
    0. Preparatory Steps
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-removing-current-container" class="md-nav__link">
    1. Removing Current Container
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-creating-a-volume" class="md-nav__link">
    2. Creating a Volume
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-configuring-cronjob-restoring-database" class="md-nav__link">
    3. Configuring cronjob &amp; Restoring database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-video-below-is-an-attempt-to-demonstrate-the-steps-above" class="md-nav__link">
    The video below is an attempt to demonstrate the steps above:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="automated-deployment">Automated Deployment</h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul>
<li>Please make sure that <strong>no one</strong> is using the system </li>
<li>Backup your database before doing any of these steps.</li>
</ul>
</div>
<h3 id="our-automated-deployment-comprises-5-steps">Our automated deployment comprises 5 steps:</h3>
<h5 id="0-preparatory-steps">0. Preparatory Steps</h5>
<ul>
<li>SSH into the server with <code>ssh openmrs@_SERVER_IP_ADDRESS</code> </li>
<li>First check to see if your server has internet connectivity with <code>ping github.com</code></li>
<li>If not try to check contents of resolv.conf in /etc/ by running the following command: cat /etc/resolv.conf.Normally you should see google.com nameserver pointing to its ip 8.8.8.8.Edit the file if name server is not configured in the file.</li>
<li>
<p>Nameserver(all in lowercase) 8.8.8.8.Ping 8.8.8.8 or google.com.After you may ping github.com just to make sure you are able to get packets from github.com</p>
</li>
<li>
<p>Then download all of the files need with <code>git clone https://github.com/eRegister/docs.git</code></p>
</li>
<li>
<p>The command above will create a folder called <code>docs</code> in <code>/home/openmrs</code> if you didn't change to another directory. All of files that need to be transfered to the server are in docs/scripts:
        * <code>gitpull.service</code>
        * <code>gitpull.sh</code>,<code>openmrs_global_properties</code>
        * <code>serialized objects</code>
        * <code>symbolic_creation.sh</code>
        * <code>visit_types.sql</code></p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>we started by ssh'ng into the server so the files are already in the server</p>
</div>
<ul>
<li>Backup facility specific configurations and configurations: 
        *  if you haven't already, backup your database with invoking the script that does that, that is already in your server: <code>docker exec -i openmrseregister /usr/bin/mysqldump -u root --password=password -A &gt; $HOME/latestback.sql</code> <em>the -A tag is going to backup everything</em>
        * do <code>ls -lh</code> to see the size of <code>latestback.sql</code> it should be 200MB or more, not less.</li>
</ul>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p><strong>PLEASE ENSURE THAT YOU HAVE BACKED UP BOTH  THE DB AND CONFIG FILES BEFORE EXECUTING THE STEPS BELOW!!!</strong></p>
</div>
<h5 id="1-removing-current-container">1. Removing Current Container</h5>
<ul>
<li>check the running container: <code>docker ps</code></li>
<li>Stop the container: <code>docker stop openmrseregister</code></li>
<li>Check that the container has stopped run <code>docker ps</code> and you should see an empty table</li>
<li>Create a new image from the stopped container: <code>docker commit openmrseregister omrsregrepo/bahmni_base:19052020</code> [<em>tag should be date at time of creating image</em>]</li>
<li>you can check the newly created image with* <code>docker images</code> </li>
<li>Remove the container: <code>docker container rm openmrseregister</code></li>
</ul>
<h5 id="2-creating-a-volume">2. Creating a Volume</h5>
<ul>
<li>create development directory <code>sudo mkdir -p /development/bahmni_config_release</code></li>
<li>change ownership of the new folder from <code>root</code> to <code>openmrs</code> with <code>sudo chown -R openmrs:openmrs /development</code> becuase the service is managed by openmrs user </li>
<li>get into the directory with <code>cd /development/bahmni_config_release</code></li>
<li>configure gitpull services</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p><strong>DO NOT</strong> use <code>git clone</code></p>
<ul>
<li>initialise new local git repo: <code>git init</code></li>
<li>if you do <code>ls -a</code> you'll see a hidden <code>.git</code> to show that indeed the folder has been intialized</li>
<li>connect local repository with remote: <code>git remote add origin https://github.com/eRegister/bahmni_config_release.git</code></li>
<li>download the latest commits to the repo: <code>git fetch --all</code> <em>you should see a log of all the latest commits downloading</em></li>
<li>now go to the home directory: <code>cd ~</code> OR <code>cd $HOME</code></li>
<li>copy <code>gitpull.service</code> file: <code>sudo cp gitpull.service /etc/systemd/system/</code></li>
<li>move <code>gitpull.sh</code> file: <code>sudo mv gitpull.sh /development/bahmni_config_release</code></li>
<li>change directory <code>cd /development/bahmni_config_release/</code> make the script executable <code>sudo chmod +x gitpull.sh</code> and <code>sudo chown openmrs:openmrs gitpull.sh</code></li>
<li>check the contents of the script with  <code>cat gitpull.sh</code> to make sure that it does <code>git fetch --all</code> and <code>git pull origin master</code> </li>
<li>also check that the service is running with <code>systemctl status gitpull.service</code></li>
<li>Nagivate into /etc/system/system/ and type the following commands to register gitpull service in system</li>
<li><code>sudo chmod 664 gitpull.service</code></li>
<li><code>sudo systemctl daemon-reload</code></li>
<li><code>sudo systemctl enable gitpull.service</code> </li>
</ul>
<p><strong> Note:when the service has been registered successfully you should see created sym link in </strong> <code>/etc/systemd/system/default.target.wants/.</code></p>
<h5 id="3-configuring-cronjob-restoring-database">3. Configuring <strong>cronjob</strong> &amp; Restoring database</h5>
<ul>
<li>configure the cronjob to trigger the service Monday 9 am</li>
<li>to edit the cronjob do: <code>sudo crontab -e</code> if it's first time running the this command it'll probably ask you to choose the default text editor, please be kind enough to choose Nano as it's the easiest editor formost administrators.</li>
<li>
<p>configure the script to run within 2 mins just to make sure everything is running OK: </p>
<pre><code>*/2 * * * * systemctl restart gitpull.service &gt;&gt; /var/log/gitpull.log2&gt;&amp;1
</code></pre>
</li>
<li>
<p>inside the crontab editor write: <code>* 7 * * mon systemctl restart gitpull.service &gt;&gt; /var/log/gitpull.log2&gt;&amp;1</code></p>
</li>
<li>
<p>Go to /development/bahmni_config_release/ and check the status of cron service to see when it has executed gitpull. service, once done check the file by typing ll or ls. For some reason you may find that the service has not pulled the files from our remote repository, first thing to do is to check the status of the service if it has successfully started. If not check the status code of the service to guide you what might went wrong. The following table shows possible exit codes of the systemd service. Another possible reason it could be that you forgot to change the ownership of the development bahmni config release, check it.</p>
<table>
<thead>
<tr>
<th><strong>EXIT CODE</strong></th>
<th align="center"><strong>SYMBOLIC NAME</strong></th>
<th align="right"><strong>DESCRIPTION</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td align="center">EXIT_SUCCESS</td>
<td align="right">Generic success code</td>
</tr>
<tr>
<td>1</td>
<td align="center">EXIT_FAILURE</td>
<td align="right">Generic failure or unspecified error(try to start the development/bahmni_config_release afresh directory )</td>
</tr>
<tr>
<td>200</td>
<td align="center">EXIT_CHDIR</td>
<td align="right">Changing to the requested working directory failed</td>
</tr>
<tr>
<td>208</td>
<td align="center">EXIT_STDIN</td>
<td align="right">Failed to setup standard input</td>
</tr>
<tr>
<td>209</td>
<td align="center">EXIT_STDOUT</td>
<td align="right">Failed to set up standard out</td>
</tr>
<tr>
<td>203</td>
<td align="center">EXIT_EXEC</td>
<td align="right">The actual process execution failed. Most likely this is caused by a missing or non-accessible executable file</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>do <code>systemctl status cron.service</code> to check that the service that will run the cronjob is running
        * to check logs of the service above you can go <code>sudo tail -f /var/log/gitpull.log</code></p>
</li>
<li>
<p>If gitpull service has pulled the bahmni config file then make a permanent </p>
</li>
<li>
<p>Now it's time to create a new container from the image we created earlier with: <code>docker run -e container_name=openmrseregister -it -d --restart always -p 443:443 -p 80:80 -p 8069:8069 -p 8000:8000 --privileged --name openmrseregister -v /development/bahmni_config_release:/development/bahmni_config_release -v openmrseregister:/openmrseregister omrsregrepo/bahmni_base:19052020 /bin/bash</code></p>
</li>
<li>
<p>after the command above you should see a container called <code>openmrseregister</code> running. </p>
</li>
<li>
<p>If the container has started successfully there is no need to restore database just copy all .sql files to container root <code>./</code> and <code>symbolic_creation.sh</code> to <code>/opt/openmrs</code> into the new running container <code>docker cp latestbackup.sql openmrseregister:/</code></p>
</li>
<li>
<p>To get into the container do: <code>docker exec -it openmrseregister bash</code></p>
</li>
<li>Change directory to <code>/development/bahmni_config</code> to check if the volume was created when starting a new container. You should see the bahmni config release files.</li>
<li>Go to <code>/var/www/</code> and run: <code>sudo rm bahmni_config</code> or <code>unlink bahmni_config</code></li>
<li>Type sudo <code>ln –s /development/bahmni_config_release/ bahmni_config</code></li>
<li>Go to <code>/opt/openmrs/</code> and make symbolic_creation executable and run it</li>
<li>start MySQL service: <code>service mysqld start</code></li>
<li>Restore all sql copied sql files <code>visit_type.sql</code>, <code>patient_identifier.sql</code>,<code>openmrs_global_property.sql</code> and <code>serial object.sql</code></li>
<li>
<p>Start other services <code>openmrs</code>,<code>httpd</code> and <code>bahmni-reports</code></p>
</li>
<li>
<p>Browse to <code>http://IP_of_eRegister/bahmni/home</code> and check if the changes have been effected.</p>
</li>
</ul>
<h5 id="the-video-below-is-an-attempt-to-demonstrate-the-steps-above">The video below is an attempt to demonstrate the steps above:</h5>
<p><a href="https://asciinema.org/a/334423"><img alt="asciicast" src="https://asciinema.org/a/334423.svg" /></a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../facilityimplementationchecklist/" title="Facility Implementation Checklist" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Facility Implementation Checklist
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Ministry of Health - Lesotho
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.7f4f3c92.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.9b3611bd.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>